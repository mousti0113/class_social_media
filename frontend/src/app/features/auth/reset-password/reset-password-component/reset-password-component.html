<div class="min-h-screen flex items-center justify-center bg-background-light dark:bg-background-dark p-4 py-8">
  <div class="w-full max-w-md flex flex-col gap-8">

    <!-- ========== STEP 1: RICHIESTA EMAIL ========== -->
    @if (currentStep() === 'request') {
      <div class="w-full rounded-xl bg-surface-light dark:bg-surface-dark p-6 sm:p-8 shadow-sm">
        <!-- Header -->
        <div class="flex flex-col gap-2 mb-6">
          <h1 class="text-2xl font-bold text-text-light dark:text-text-dark">
            Hai dimenticato la password?
          </h1>
          <p class="text-base text-gray-600 dark:text-gray-400">
            Inserisci la tua email per ricevere un link di reimpostazione.
          </p>
        </div>

        <!-- Messaggio errore -->
        @if (errorMessage()) {
          <div class="mb-6 p-4 rounded-lg bg-error-50 dark:bg-error-900/30 border border-error-200 dark:border-error-800">
            <p class="text-sm text-error-700 dark:text-error-300">
              {{ errorMessage() }}
            </p>
          </div>
        }

        <!-- Form richiesta -->
        <form [formGroup]="requestForm" (ngSubmit)="onRequestSubmit()" class="flex flex-col gap-6">
          <app-input-component
            formControlName="email"
            type="email"
            label="Indirizzo Email"
            placeholder="nome.cognome@marconirovereto.it"
            [required]="true"
            [error]="getRequestFieldError('email')"
            autocomplete="email"
            size="lg"
          />

          <app-button
            type="submit"
            variant="primary"
            size="lg"
            [fullWidth]="true"
            [loading]="isLoading()"
            [disabled]="requestForm.invalid && requestForm.touched"
          >
            Invia link di reset
          </app-button>
        </form>

        <!-- Link torna al login -->
        <a
          routerLink="/auth/login"
          class="block text-center text-sm text-gray-600 dark:text-gray-400 pt-6 hover:text-primary-500 dark:hover:text-primary-400 underline"
        >
          Torna al Login
        </a>
      </div>
    }

    <!-- ========== STEP 2: EMAIL INVIATA ========== -->
    @if (currentStep() === 'sent') {
      <div class="w-full rounded-xl bg-surface-light dark:bg-surface-dark p-6 sm:p-8 shadow-sm text-center">
        <!-- Icona successo -->
        <div class="flex items-center justify-center h-16 w-16 bg-success-100 dark:bg-success-900/30 rounded-full mx-auto mb-6">
          <lucide-icon
            [img]="MailCheckIcon"
            class="w-8 h-8 text-success-600 dark:text-success-400"
          />
        </div>

        <!-- Testo conferma -->
        <div class="flex flex-col gap-2 mb-6">
          <h1 class="text-2xl font-bold text-text-light dark:text-text-dark">
            Controlla la tua email
          </h1>
          <p class="text-base text-gray-600 dark:text-gray-400">
            Abbiamo inviato un link per la reimpostazione della password a
            <span class="font-medium text-text-light dark:text-text-dark">
              {{ submittedEmail() }}
            </span>.
            Potrebbe essere necessario controllare la cartella spam.
          </p>
        </div>

        <!-- Link torna al login -->
        <a
          routerLink="/auth/login"
          class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary-500 dark:hover:text-primary-400 underline"
        >
          Torna al Login
        </a>
      </div>
    }

    <!-- ========== STEP 3: NUOVA PASSWORD ========== -->
    @if (currentStep() === 'reset') {
      <div class="w-full rounded-xl bg-surface-light dark:bg-surface-dark p-6 sm:p-8 shadow-sm">
        <!-- Header -->
        <div class="flex flex-col gap-2 mb-6">
          <h1 class="text-2xl font-bold text-text-light dark:text-text-dark">
            Crea una nuova password
          </h1>
          <p class="text-base text-gray-600 dark:text-gray-400">
            La tua nuova password deve contenere almeno 6 caratteri.
          </p>
        </div>

        <!-- Messaggio errore -->
        @if (errorMessage()) {
          <div class="mb-6 p-4 rounded-lg bg-error-50 dark:bg-error-900/30 border border-error-200 dark:border-error-800">
            <p class="text-sm text-error-700 dark:text-error-300">
              {{ errorMessage() }}
            </p>
          </div>
        }

        <!-- Form nuova password -->
        <form [formGroup]="resetForm" (ngSubmit)="onResetSubmit()" class="flex flex-col gap-6">
          <app-input-component
            formControlName="password"
            type="password"
            label="Nuova Password"
            placeholder="Inserisci la nuova password"
            [required]="true"
            [error]="getResetFieldError('password')"
            autocomplete="new-password"
            size="lg"
          />

          <app-input-component
            formControlName="confirmPassword"
            type="password"
            label="Conferma Nuova Password"
            placeholder="Reinserisci la nuova password"
            [required]="true"
            [error]="getResetFieldError('confirmPassword')"
            autocomplete="new-password"
            size="lg"
          />

          <app-button
            type="submit"
            variant="primary"
            size="lg"
            [fullWidth]="true"
            [loading]="isLoading()"
            [disabled]="resetForm.invalid && resetForm.touched"
          >
            Reimposta Password
          </app-button>
        </form>
      </div>
    }

    <!-- ========== STEP 4: SUCCESSO ========== -->
    @if (currentStep() === 'success') {
      <div class="w-full rounded-xl bg-surface-light dark:bg-surface-dark p-6 sm:p-8 shadow-sm">
        <!-- Messaggio successo -->
        <div class="flex items-center gap-3 rounded-lg bg-success-50 dark:bg-success-900/30 p-4 mb-6">
          <lucide-icon
            [img]="CheckCircleIcon"
            class="w-6 h-6 text-success-600 dark:text-success-400 flex-shrink-0"
          />
          <p class="text-success-800 dark:text-success-300 font-medium">
            Password aggiornata con successo!
          </p>
        </div>

        <p class="text-center text-gray-600 dark:text-gray-400 mb-6">
          Ora puoi accedere con la tua nuova password.
        </p>

        <app-button
          variant="primary"
          size="lg"
          [fullWidth]="true"
          (clicked)="goToLogin()"
        >
          Vai al Login
        </app-button>
      </div>
    }

  </div>
</div>