<!-- Reply indicator -->
@if (isReplyMode()) {
  <div class="flex items-center justify-between px-3 py-2 bg-gray-50 dark:bg-gray-700/50 rounded-t-lg border border-b-0 border-gray-200 dark:border-gray-700">
    <span class="text-sm text-gray-600 dark:text-gray-400">
      Rispondendo a 
      <span class="font-medium text-gray-900 dark:text-white">
        &#64;{{ replyTo()?.autore?.username }}
      </span>
    </span>
    <button
      type="button"
      class="p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200 dark:hover:text-gray-300 dark:hover:bg-gray-600 transition-colors"
      (click)="cancel()"
    >
      <lucide-icon [img]="XIcon" [size]="16"></lucide-icon>
    </button>
  </div>
}

<!-- Form -->
<div 
  class="flex gap-3 p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"
  [class.rounded-lg]="!isReplyMode()"
  [class.rounded-b-lg]="isReplyMode()"
>
  <!-- Avatar utente corrente -->
  @if (currentUser(); as user) {
    <app-avatar
      [src]="user.profilePictureUrl"
      [alt]="user.nomeCompleto"
      [name]="user.nomeCompleto"
      size="sm"
      status="online"
      class="shrink-0"
    />
  }

  <!-- Input area -->
  <div class="flex-1 flex gap-2">
    <textarea
      #textareaEl
      appAutoResize
      [minRows]="1"
      [maxRows]="5"
      class="flex-1 px-3 py-2 text-sm border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white resize-none focus:border-primary-500 focus:bg-white dark:focus:bg-gray-600 focus:outline-none transition-colors"
      [placeholder]="dynamicPlaceholder()"
      [value]="content()"
      (input)="onInput($event)"
      (keydown)="onKeydown($event)"
    ></textarea>

    <!-- Submit button -->
    <button
      type="button"
      class="shrink-0 p-2 rounded-lg transition-colors"
      [class]="isSubmitDisabled()
        ? 'text-gray-400 dark:text-gray-500 cursor-not-allowed'
        : 'text-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20'"
      [disabled]="isSubmitDisabled()"
      (click)="submit()"
    >
      <lucide-icon [img]="SendIcon" [size]="20"></lucide-icon>
    </button>
  </div>
</div>

<!-- Hint -->
<p class="mt-1 text-xs text-gray-400 dark:text-gray-500 text-right">
  Ctrl + Enter per inviare
</p>